<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SMS Campaign Pro - By Usaim</title>
  <link rel="manifest" href="manifest.json" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="style.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg px-3">
    <a class="navbar-brand" href="#">üì≤ SMS Campaign Pro</a>
    <div class="ms-auto d-flex align-items-center">
      <select id="langSelect" class="form-select form-select-sm me-2" style="width:auto;">
        <option value="en">EN</option>
        <option value="es">ES</option>
        <option value="fr">FR</option>
      </select>
      <button class="btn btn-sm btn-outline-light me-2" id="themeToggleBtn" onclick="toggleTheme()">
        <span id="themeIcon">üåì</span>
      </button>
      <button class="btn btn-sm btn-outline-info" data-bs-toggle="modal" data-bs-target="#loginModal">Login</button>
    </div>
  </nav>

  <div class="container py-4">
    <!-- Tabs for navigation -->
    <ul class="nav nav-tabs mb-3" id="mainTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="sms-tab" data-bs-toggle="tab" data-bs-target="#smsTab" type="button" role="tab">Send SMS</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="logs-tab" data-bs-toggle="tab" data-bs-target="#logsTab" type="button" role="tab">Logs</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="templates-tab" data-bs-toggle="tab" data-bs-target="#templatesTab" type="button" role="tab">Templates</button>
      </li>
    </ul>
    <div class="tab-content">
      <!-- SMS Form Tab -->
      <div class="tab-pane fade show active" id="smsTab" role="tabpanel">
        <div class="row g-4">
          <div class="col-lg-4">
            <div class="card shadow">
              <div class="card-header">
                <h5>Send New SMS</h5>
              </div>
              <div class="card-body">
                <form id="smsForm" autocomplete="off">
                  <div class="mb-2">
                    <label for="customerName" class="form-label">Customer Name</label>
                    <input type="text" class="form-control form-control-sm" id="customerName" required />
                  </div>
                  <div class="mb-2">
                    <label for="bankName" class="form-label">Bank Name</label>
                    <input type="text" class="form-control form-control-sm" id="bankName" required />
                  </div>
                  <div class="mb-2">
                    <label for="amount" class="form-label">Amount</label>
                    <input type="number" class="form-control form-control-sm" id="amount" min="1" required />
                  </div>
                  <div class="mb-2">
                    <label for="transactionType" class="form-label">Transaction Type</label>
                    <select class="form-select form-select-sm" id="transactionType" required>
                      <option value="" selected disabled>Select</option>
                      <option value="debited">Debited</option>
                      <option value="credited">Credited</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <label for="userType" class="form-label">User Type</label>
                    <select class="form-select form-select-sm" id="userType" required>
                      <option value="" selected disabled>Select</option>
                      <option value="Personal">Personal</option>
                      <option value="Business">Business</option>
                    </select>
                  </div>
                  <div class="mb-2">
                    <label for="smsTemplate" class="form-label">Template</label>
                    <select id="smsTemplate" class="form-select form-select-sm" onchange="applyTemplate(this.value)"></select>
                    <button type="button" class="btn btn-sm btn-outline-secondary mt-1" onclick="suggestSMS()">AI Suggest</button>
                  </div>
                  <button type="submit" class="btn glow-btn w-100" id="sendBtn">
                    <span>Send SMS</span>
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                  </button>
                </form>
              </div>
            </div>
            <div class="card shadow mt-4">
              <div class="card-header">
                <span>üîç Search</span>
              </div>
              <div class="card-body">
                <input type="text" class="form-control" id="searchInput" placeholder="Search by customer name..." />
              </div>
            </div>
            <div class="card shadow mt-4">
              <div class="card-header">
                <span>üîé Filters & Columns</span>
              </div>
              <div class="card-body">
                <div class="mb-2">
                  <button class="btn btn-sm btn-outline-info me-1" onclick="setFilterType('all')">All</button>
                  <button class="btn btn-sm btn-outline-success me-1" onclick="setFilterType('credited')">Credited</button>
                  <button class="btn btn-sm btn-outline-danger" onclick="setFilterType('debited')">Debited</button>
                </div>
                <div class="mb-2">
                  <span class="fw-bold">Show Columns:</span>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" checked onchange="toggleColumn('name')">
                    <label class="form-check-label">Name</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" checked onchange="toggleColumn('bank')">
                    <label class="form-check-label">Bank</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" checked onchange="toggleColumn('amount')">
                    <label class="form-check-label">Amount</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" checked onchange="toggleColumn('type')">
                    <label class="form-check-label">Type</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" checked onchange="toggleColumn('userType')">
                    <label class="form-check-label">User Type</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" checked onchange="toggleColumn('status')">
                    <label class="form-check-label">Status</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" checked onchange="toggleColumn('time')">
                    <label class="form-check-label">Time</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" checked onchange="toggleColumn('action')">
                    <label class="form-check-label">Action</label>
                  </div>
                </div>
                <button class="btn btn-sm btn-danger mt-2" onclick="bulkDelete()">Bulk Delete</button>
              </div>
            </div>
          </div>
          <div class="col-lg-8">
            <div class="card shadow">
              <div class="card-header d-flex justify-content-between align-items-center">
                <span>üì® SMS Preview</span>
                <button class="btn btn-sm btn-outline-info" onclick="copyPreview()">Copy</button>
              </div>
              <div class="card-body" id="smsPreview">
                <!-- SMS preview will appear here -->
              </div>
            </div>
            <div class="row mt-4">
              <div class="col-md-3">
                <div class="card shadow">
                  <div class="card-header">Total Debited</div>
                  <div class="card-body text-center">
                    <h4 class="text-danger mb-0">‚Çπ<span id="totalDebited">0.00</span></h4>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card shadow">
                  <div class="card-header">Total Credited</div>
                  <div class="card-body text-center">
                    <h4 class="text-success mb-0">‚Çπ<span id="totalCredited">0.00</span></h4>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card shadow">
                  <div class="card-header">Total Transactions</div>
                  <div class="card-body text-center">
                    <h4 class="mb-0"><span id="totalCount">0</span></h4>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card shadow">
                  <div class="card-header">üíπ Overview</div>
                  <div class="card-body">
                    <canvas id="transactionChart" height="120"></canvas>
                    <canvas id="pieChart" height="120" class="mt-3"></canvas>
                    <div class="progress mt-3" style="height: 20px;">
                      <div id="debitedBar" class="progress-bar bg-danger" role="progressbar" style="width: 50%;">Debited</div>
                      <div id="creditedBar" class="progress-bar bg-success" role="progressbar" style="width: 50%;">Credited</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Logs Tab -->
      <div class="tab-pane fade" id="logsTab" role="tabpanel">
        <div class="mb-2">
          <input type="date" id="dateFrom" class="form-control form-control-sm d-inline-block" style="width:auto;">
          <span>to</span>
          <input type="date" id="dateTo" class="form-control form-control-sm d-inline-block" style="width:auto;">
          <button class="btn btn-sm btn-outline-primary" onclick="filterByDate()">Filter</button>
        </div>
        <div class="card mt-3 shadow">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5>üìã Transaction Logs</h5>
            <div>
              <button class="btn btn-sm btn-danger" onclick="clearLogs()">üóëÔ∏è Clear All</button>
              <button class="btn btn-sm btn-success ms-2" onclick="exportToCSV()">‚¨áÔ∏è Export CSV</button>
              <button class="btn btn-sm btn-primary ms-2" onclick="exportToPDF()">‚¨áÔ∏è Export PDF</button>
              <button class="btn btn-sm btn-secondary ms-2" id="undoBtn" onclick="undoDelete()" style="display:none;">‚Ü©Ô∏è Undo Delete</button>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-hover table-bordered align-middle">
              <thead class="table-dark text-center">
                <tr>
                  <th>Name</th>
                  <th>Bank</th>
                  <th>Amount</th>
                  <th>Type</th>
                  <th>User Type</th>
                  <th>Status</th>
                  <th>Time</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="logTableBody">
                <!-- Transaction rows will appear here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- Templates Tab -->
      <div class="tab-pane fade" id="templatesTab" role="tabpanel">
        <div class="card shadow">
          <div class="card-header">Manage SMS Templates</div>
          <div class="card-body">
            <ul id="templateList"></ul>
            <!-- Add template management UI as needed -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Spinner for Export -->
  <div id="loadingSpinner" class="spinner-border text-info" style="display:none;position:fixed;top:50%;left:50%;z-index:2000;"></div>

  <!-- Login Modal -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-center p-4">
        <h5>Login</h5>
        <input type="text" id="loginUser" class="form-control mb-2" placeholder="Username">
        <input type="password" id="loginPass" class="form-control mb-2" placeholder="Password">
        <button class="btn btn-primary w-100" onclick="login()">Login</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055;">
    <div id="toast" class="toast bg-success text-white" data-bs-delay="3000" role="alert">
      <div class="toast-body">SMS Sent Successfully!</div>
    </div>
  </div>

  <canvas id="confettiCanvas" style="position:fixed;pointer-events:none;top:0;left:0;width:100vw;height:100vh;z-index:2000;display:none"></canvas>
  <audio id="smsSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b9bfae3.mp3"></audio>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="script.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
</body>
</html>
